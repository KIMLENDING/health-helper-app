````md
# 모바일 환경에서 정확한 타이머를 만들기 위한 고민과 개선

React 기반 운동 앱을 개발하면서 `useStopwatch` 훅을 직접 구현하게 되었습니다. 단순히 시간만 측정하면 되는 줄 알았지만, **모바일 환경에서는 생각보다 많은 문제가 발생**했습니다.

이 글은 제가 그 과정에서 마주친 문제들과 그에 대한 해결 과정, 그리고 선택한 기술적 접근법에 대한 기록입니다.

---

## 문제 상황: `setInterval` 타이머가 멈춘다?

처음엔 흔히 사용하는 `setInterval`로 구현했습니다.

```tsx
const interval = setInterval(updateTimer, 100); // 100ms마다 실행
```
````

간단하고 잘 작동하는 것 같았지만... **모바일 브라우저에서 앱을 잠시 백그라운드로 보내고 다시 돌아오면, 시간 측정이 엉망이었습니다.**

- 실제로 5분이 지났는데, 3\~4분밖에 측정되지 않음
- 모바일 기기의 **전력 최적화 정책**으로 인해 interval 자체가 멈춰버림

---

## 원인 분석

모바일 환경에서 브라우저는 백그라운드 탭의 `setInterval`, `setTimeout`을 제한합니다.
100ms 단위로 설정한 interval은 백그라운드 상태에선 거의 실행되지 않습니다.

| API                     | 백그라운드에서의 동작                         |
| ----------------------- | --------------------------------------------- |
| `setInterval`           | 대부분 멈추거나 주기가 매우 느려짐            |
| `requestAnimationFrame` | 아예 중단되지만 다시 활성화 시 시간 보정 가능 |

---

## 해결 전략: 시간은 누적하지 말고 **계산**하자

단순히 1초마다 시간 += 1을 하는 대신, **"언제 시작했고, 지금이 몇 시인지"를 기준으로 계산**하면 정확한 시간이 나옵니다.

그래서 `requestAnimationFrame`과 `Date.now()` 기반의 방식으로 구조를 바꿨습니다:

```tsx
const elapsedTime = (Date.now() - startTimeRef.current) / 1000 + 이전 저장된 시간;
```

- 백그라운드에 있을 때는 `requestAnimationFrame`이 중단되더라도,
- 다시 활성화될 때 정확한 경과 시간을 계산 가능

---

## 두 버전 비교

| 항목          | setInterval 방식 (`use-stopwatch2.tsx`) | requestAnimationFrame 방식 (`use-stopwatch3.tsx`) |
| ------------- | --------------------------------------- | ------------------------------------------------- |
| 모바일 정확도 | ❌ 떨어짐                               | ✅ 정확                                           |
| 코드 단순성   | ✅ 높음                                 | ⚠️ 약간 복잡                                      |
| 신뢰성        | ❌ 낮음                                 | ✅ 높음                                           |

---

## 포트폴리오에 남기는 나의 선택

이 경험을 통해 **시간을 누적하는 방식보다 계산하는 방식이 더 신뢰성 있다**는 것을 배웠습니다. 특히:

- 모바일 사용자도 고려해야 한다는 점
- 백그라운드 환경의 브라우저 제한 사항을 이해하는 것이 중요함
- 결국 사용자의 **실제 경험**이 우선이라는 점

최종적으로는 `requestAnimationFrame + Date.now()` 기반 방식(`use-stopwatch3.tsx`)을 채택했고, 현재까지도 모바일 환경에서 정확하게 동작하고 있습니다.

---

## 참고

- [`use-stopwatch2.tsx`](https://github.com/KIMLENDING/health-helper-app/blob/master/hooks//use-stopwatch2.tsx): 초기 구현 (`setInterval`)
- [`use-stopwatch3.tsx`](https://github.com/KIMLENDING/health-helper-app/blob/master/hooks/use-stopwatch3.tsx): 개선된 구현 (`rAF + Date.now()`)

---

이 경험을 통해 **React에서 정밀한 시간 제어를 어떻게 다뤄야 하는지**, 그리고 **사용자 환경을 고려한 설계의 중요성**을 체감할 수 있었습니다.

기능은 만들었는데 전체적으로 수정을 하면서 이 기능을 서버 측으로 넘기면서 이 훅을 사용할 수 없게 되어 아쉽게 되었음.....
